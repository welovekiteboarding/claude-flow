<!DOCTYPE html>
<html>
<head>
    <title>ğŸ¯ FINAL VERIFICATION - Zoom & Textures</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: Arial; }
        #status { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.8); padding: 15px; z-index: 1000; border-radius: 5px; }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #FF9800; }
        .info { color: #2196F3; }
        hr { border: 1px solid #333; margin: 10px 0; }
        .test-result { margin: 5px 0; padding: 5px; border-radius: 3px; }
        .test-pass { background: rgba(76, 175, 80, 0.2); }
        .test-fail { background: rgba(244, 67, 54, 0.2); }
        .test-pending { background: rgba(255, 152, 0, 0.2); }
    </style>
</head>
<body>
    <div id="status">
        <h3>ğŸ¯ FINAL VERIFICATION</h3>
        <div class="test-result test-pending" id="zoom-test">ğŸ–±ï¸ Zoom Test: <span id="zoom-status">Ready - Use mouse wheel</span></div>
        <div class="test-result test-pending" id="texture-test">ğŸ¨ Texture Test: <span id="texture-status">Loading...</span></div>
        <div class="test-result" id="camera-info">ğŸ“· Camera: <span id="camera-pos">--</span></div>
        <div class="test-result" id="fps-info">âš¡ FPS: <span id="fps-count">--</span></div>
        <hr>
        <div id="instructions">
            <strong>Test Instructions:</strong><br>
            1. Use mouse wheel to test zoom<br>
            2. Look for Earth texture (should NOT be solid blue)<br>
            3. Both should work simultaneously<br>
            4. Camera position should update in real-time
        </div>
        <hr>
        <div id="results">
            <div id="overall-status">ğŸ”„ Testing in progress...</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="js/cameraControls.js"></script>
    <script>
        console.log('ğŸ¯ FINAL VERIFICATION: Starting comprehensive test...');
        
        // Test results tracking
        let testResults = {
            zoom: false,
            texture: false,
            cameraControls: false,
            rendering: false
        };

        // Scene setup
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setClearColor(0x000000);
        document.body.appendChild(renderer.domElement);

        console.log('ğŸ¯ Scene created successfully');

        // Add lighting for textures
        const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(5, 3, 5);
        scene.add(directionalLight);

        console.log('ğŸ¯ Lighting setup complete');

        // Position camera at known location
        camera.position.set(0, 0, 5);
        camera.lookAt(0, 0, 0);

        console.log('ğŸ¯ Camera positioned at:', camera.position.x, camera.position.y, camera.position.z);

        // Create Earth with texture
        const geometry = new THREE.SphereGeometry(1, 32, 32);
        const material = new THREE.MeshPhongMaterial({ color: 0xffffff });
        const earth = new THREE.Mesh(geometry, material);
        scene.add(earth);

        console.log('ğŸ¯ Earth sphere created');

        // Initialize camera controls
        let cameraControls;
        try {
            cameraControls = new CameraControls(camera, renderer.domElement, scene);
            console.log('ğŸ¯ âœ… Camera controls initialized successfully');
            console.log('ğŸ¯ Initial spherical:', cameraControls.spherical.radius, cameraControls.spherical.theta, cameraControls.spherical.phi);
            testResults.cameraControls = true;
        } catch (error) {
            console.error('ğŸ¯ âŒ Camera controls failed:', error);
            document.getElementById('zoom-status').innerHTML = '<span class="error">âŒ Controls Init Failed</span>';
            document.getElementById('zoom-test').className = 'test-result test-fail';
        }

        // Test texture loading with reliable URL
        const textureLoader = new THREE.TextureLoader();
        const earthUrl = 'https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/planets/earth_atmos_2048.jpg';
        
        console.log('ğŸ¯ Starting texture load test with URL:', earthUrl);
        
        textureLoader.load(
            earthUrl,
            function(texture) {
                console.log('ğŸ¯ âœ… Texture loaded successfully');
                console.log('ğŸ¯ Texture dimensions:', texture.image.width, 'x', texture.image.height);
                
                material.map = texture;
                material.needsUpdate = true;
                testResults.texture = true;
                
                document.getElementById('texture-status').innerHTML = '<span class="success">âœ… Working</span>';
                document.getElementById('texture-test').className = 'test-result test-pass';
                
                updateOverallStatus();
            },
            function(progress) {
                console.log('ğŸ¯ Texture loading progress:', progress);
                document.getElementById('texture-status').innerHTML = '<span class="warning">â³ Loading...</span>';
            },
            function(error) {
                console.error('ğŸ¯ âŒ Texture loading failed:', error);
                document.getElementById('texture-status').innerHTML = '<span class="error">âŒ Failed</span>';
                document.getElementById('texture-test').className = 'test-result test-fail';
                updateOverallStatus();
            }
        );

        // Test zoom functionality
        let zoomEvents = 0;
        let lastZoomTest = 0;
        
        renderer.domElement.addEventListener('wheel', function(event) {
            zoomEvents++;
            console.log(`ğŸ¯ ZOOM EVENT #${zoomEvents}: deltaY=${event.deltaY}`);
            
            const beforePos = camera.position.clone();
            const beforeRadius = cameraControls ? cameraControls.spherical.radius : 'unknown';
            
            setTimeout(() => {
                const afterPos = camera.position.clone();
                const afterRadius = cameraControls ? cameraControls.spherical.radius : 'unknown';
                const moved = beforePos.distanceTo(afterPos);
                const radiusChange = Math.abs(beforeRadius - afterRadius);
                
                console.log(`ğŸ¯ ZOOM EVENT #${zoomEvents} RESULT:`);
                console.log(`  Position change: ${moved.toFixed(4)}`);
                console.log(`  Radius change: ${radiusChange.toFixed(4)}`);
                console.log(`  Before: (${beforePos.x.toFixed(2)}, ${beforePos.y.toFixed(2)}, ${beforePos.z.toFixed(2)})`);
                console.log(`  After: (${afterPos.x.toFixed(2)}, ${afterPos.y.toFixed(2)}, ${afterPos.z.toFixed(2)})`);
                
                if (moved > 0.001 || radiusChange > 0.001) {
                    testResults.zoom = true;
                    document.getElementById('zoom-status').innerHTML = '<span class="success">âœ… Working</span>';
                    document.getElementById('zoom-test').className = 'test-result test-pass';
                } else {
                    document.getElementById('zoom-status').innerHTML = '<span class="error">âŒ Not Working</span>';
                    document.getElementById('zoom-test').className = 'test-result test-fail';
                }
                
                updateOverallStatus();
            }, 50);
        });

        // FPS monitoring
        let frameCount = 0;
        let lastTime = performance.now();
        let fps = 0;

        function updateFPS() {
            frameCount++;
            const currentTime = performance.now();
            
            if (currentTime - lastTime >= 1000) {
                fps = Math.round(frameCount * 1000 / (currentTime - lastTime));
                document.getElementById('fps-count').textContent = fps;
                frameCount = 0;
                lastTime = currentTime;
                
                if (fps > 30) {
                    testResults.rendering = true;
                }
            }
        }

        function updateCameraDisplay() {
            if (cameraControls) {
                document.getElementById('camera-pos').textContent = 
                    `(${camera.position.x.toFixed(2)}, ${camera.position.y.toFixed(2)}, ${camera.position.z.toFixed(2)})`;
            }
        }

        function updateOverallStatus() {
            const passedTests = Object.values(testResults).filter(Boolean).length;
            const totalTests = Object.keys(testResults).length;
            
            let statusText = '';
            let statusClass = '';
            
            if (passedTests === totalTests) {
                statusText = 'ğŸ‰ ALL TESTS PASSED - Both zoom and textures working!';
                statusClass = 'success';
            } else if (passedTests > 0) {
                statusText = `âš ï¸ ${passedTests}/${totalTests} tests passed - Still testing...`;
                statusClass = 'warning';
            } else {
                statusText = 'âŒ Tests in progress...';
                statusClass = 'info';
            }
            
            document.getElementById('overall-status').innerHTML = `<span class="${statusClass}">${statusText}</span>`;
            
            // Log detailed results
            console.log('ğŸ¯ TEST RESULTS:', testResults);
        }

        // Render loop
        function animate() {
            requestAnimationFrame(animate);
            
            if (cameraControls) {
                cameraControls.update();
            }
            
            // Slow Earth rotation for visual reference
            earth.rotation.y += 0.005;
            
            renderer.render(scene, camera);
            
            updateFPS();
            updateCameraDisplay();
        }

        // Start rendering
        animate();
        
        // Initial status update
        updateOverallStatus();
        
        // Periodic updates
        setInterval(updateCameraDisplay, 100);
        
        console.log('ğŸ¯ FINAL VERIFICATION: Test environment ready!');
        console.log('ğŸ¯ Instructions:');
        console.log('  1. Use mouse wheel to test zoom');
        console.log('  2. Look for Earth texture (should NOT be solid blue)');
        console.log('  3. Check console for detailed test results');
        
        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Auto-test after 3 seconds if no user interaction
        setTimeout(() => {
            if (!testResults.zoom) {
                console.log('ğŸ¯ Auto-testing zoom after 3 seconds...');
                // Simulate a small wheel event to test the system
                const wheelEvent = new WheelEvent('wheel', { deltaY: -100 });
                renderer.domElement.dispatchEvent(wheelEvent);
            }
        }, 3000);

    </script>
</body>
</html>